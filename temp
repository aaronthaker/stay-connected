import pandas as pd

# Load Excel file
file_path = 'your_file.xlsx'  # Replace with your Excel file path
df_current = pd.read_excel(file_path, sheet_name='CurrentGen')
df_next = pd.read_excel(file_path, sheet_name='NextGen')

# Columns to use
current_just_col = 'Justification'  # Adjust this if your column has a slightly different name
next_just_col = 'Justification'     # Same here

# Output matches
matches = []

for index, row in df_current.iterrows():
    current_just = row[current_just_col]
    print(f"\n[{index}] CurrentGen Justification:\n{current_just}\n")

    while True:
        search_input = input("Enter keywords to search in NextGen (or type 'skip' to skip this alert): ").strip()
        if search_input.lower() == 'skip':
            print("Skipped.")
            break

        search_words = search_input.lower().split()
        filtered = df_next[df_next[next_just_col].str.lower().apply(
            lambda x: all(word in x for word in search_words)
        )]

        if filtered.empty:
            print("No matches found. Try again.")
            continue

        print("\nMatches found:")
        for i, match_row in filtered.iterrows():
            print(f"[{i}] {match_row[next_just_col]}\n")

        selected = input("Enter the number of the correct match (or 'retry' or 'skip'): ").strip()
        if selected.lower() == 'retry':
            continue
        elif selected.lower() == 'skip':
            print("Skipped.")
            break
        elif selected.isdigit() and int(selected) in filtered.index:
            matched_row = filtered.loc[int(selected)]
            matches.append({
                'CurrentGen_Justification': current_just,
                'NextGen_Justification': matched_row[next_just_col]
            })
            print("Match recorded.")
            break
        else:
            print("Invalid input. Try again.")

# Save matches
match_df = pd.DataFrame(matches)
match_df.to_excel('matched_alerts.xlsx', index=False)
print("\nAll done. Matches saved to matched_alerts.xlsx.")